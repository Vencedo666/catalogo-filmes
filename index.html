<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2KO VIP - Catálogo de Filmes</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #fff;
      margin: 0;
      padding: 20px;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      padding: 20px;
    }
    header img {
      width: 120px;
      margin-bottom: 10px;
    }
    h1 {
      text-align: center;
      margin-bottom: 10px;
    }
    .search-filter {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    input[type="text"], select {
      padding: 10px;
      border-radius: 5px;
      border: none;
      font-size: 16px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      padding: 20px;
    }
    .card {
      background: #222;
      border-radius: 10px;
      overflow: hidden;
      transition: transform 0.2s;
      cursor: pointer;
    }
    .card:hover {
      transform: scale(1.03);
    }
    .card img {
      width: 100%;
      height: 300px;
      object-fit: cover;
    }
    .card-content {
      padding: 10px;
    }
    .title {
      font-size: 16px;
      font-weight: bold;
      margin: 0 0 5px 0;
    }
    .meta {
      font-size: 14px;
      color: #aaa;
    }
    .description {
      font-size: 13px;
      margin-top: 5px;
      color: #ccc;
    }
  </style>
</head>
<body>
  <header>
    <img src="photo_4994677211969728445_c.jpg" alt="2KO VIP Logo">
    <h1>2KO VIP - Catálogo de Filmes</h1>
  </header>
  <div class="search-filter">
    <input type="text" id="search" placeholder="Pesquisar...">
    <select id="filter">
      <option value="">Todos os Tipos</option>
      <option value="Filme">Filmes</option>
      <option value="Anime">Animes / Donghua</option>
      <option value="Série">Séries</option>
      <option value="Animação">Animações</option>
    </select>
  </div>
  <div id="catalog" class="grid"></div>

  <script>
    const sheetId = '1zWKuIBt1Fy2c-CZ2MjZsuWWtBRn8jDq3Uh4KUI7EGPk';
    const sheetUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json`;

    const normalize = str => str
      .toLowerCase()
      .normalize("NFD").replace(/[̀-ͯ]/g, "")
      .replace(/[\-;]/g, '')
      .trim();

    let items = [];

    fetch(sheetUrl)
      .then(res => res.text())
      .then(text => {
        const json = JSON.parse(text.substring(47).slice(0, -2));
        const rows = json.table.rows.slice(1); // Ignora cabeçalho
        items = rows.map(row => {
          const [titulo, tipo, genero, banner, descricao, link] = row.c.map(cell => cell?.v || '');
          return { titulo, tipo, genero, banner, descricao, link };
        });
        renderCatalog(items);
      })
      .catch(err => {
        document.getElementById('catalog').innerHTML = '<p>Erro ao carregar catálogo.</p>';
        console.error('Erro:', err);
      });

    function renderCatalog(data) {
      const catalog = document.getElementById('catalog');
      catalog.innerHTML = '';

      data.forEach(item => {
        const card = document.createElement('div');
        card.className = 'card';
        card.onclick = () => window.open(item.link, '_blank');

        card.innerHTML = `
          <img src="${item.banner}" alt="${item.titulo}" />
          <div class="card-content">
            <div class="title">${item.titulo}</div>
            <div class="meta">${item.tipo} | ${item.genero}</div>
            <div class="description">${item.descricao}</div>
          </div>
        `;

        catalog.appendChild(card);
      });
    }

    document.getElementById('search').addEventListener('input', filterItems);
    document.getElementById('filter').addEventListener('change', filterItems);

    function filterItems() {
      const searchValue = normalize(document.getElementById('search').value);
      const filterValue = document.getElementById('filter').value;

      const filtered = items.filter(item => {
        const isMatch = normalize(item.titulo).includes(searchValue);
        const tipoMatch = !filterValue ||
          (filterValue === 'Anime' && ['anime', 'donghua'].includes(normalize(item.tipo))) ||
          normalize(item.tipo) === normalize(filterValue);
        return isMatch && tipoMatch;
      });

      renderCatalog(filtered);
    }
  </script>
</body>
</html>
