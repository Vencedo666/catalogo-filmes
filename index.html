<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2KO VIP - Cat√°logo de Filmes</title>
  <style>
    :root {
      --bg-main: #f1cf60;
      --text-light: #fff;
      --card-bg: #222;
      --card-hover: #333;
      --star-default: rgba(255, 255, 255, 0.3);
      --star-favorite: #ff0;
    }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #111;
      color: var(--text-light);
    }

    header {
      background-color: var(--bg-main);
      padding: 10px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      position: relative;
    }

    header img {
      height: 40px;
    }

    .menu {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .menu button {
      background-color: #000;
      color: #fff;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      border-radius: 5px;
    }

    .popup {
      display: none;
      position: absolute;
      top: 60px;
      left: 120px;
      background: #000;
      border: 1px solid #fff;
      padding: 10px;
      z-index: 10;
      max-height: 80vh;
      overflow-y: auto;
    }

    .popup button {
      display: block;
      width: 100%;
      margin-bottom: 5px;
    }

    .popup hr {
      border: none;
      border-top: 1px solid #555;
      margin: 10px 0;
    }

    .popup .close-btn {
      background: red;
      color: white;
      padding: 5px;
      font-weight: bold;
      border-radius: 3px;
      text-align: center;
      cursor: pointer;
      margin-bottom: 10px;
    }

    .carousel {
      overflow-x: auto;
      display: flex;
      scroll-snap-type: x mandatory;
      padding: 10px;
      position: relative;
    }

    .carousel::-webkit-scrollbar {
      display: none;
    }

    .card {
      flex: 0 0 calc(20% - 10px);
      margin-right: 10px;
      background: var(--card-bg);
      border-radius: 10px;
      overflow: hidden;
      scroll-snap-align: start;
      position: relative;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .card:hover {
      transform: scale(1.03);
    }

    .card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }

    .card-content {
      padding: 10px;
    }

    .title {
      font-size: clamp(10px, 2.5vw, 16px);
      font-weight: bold;
      margin: 0 0 5px 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      animation: marquee 8s linear infinite;
    }

    @keyframes marquee {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }

    .meta, .description {
      font-size: 13px;
      color: #aaa;
    }

    .star {
      position: absolute;
      top: 5px;
      right: 5px;
      font-size: 20px;
      color: var(--star-default);
      border: none;
      text-shadow: 1px 1px 2px black;
    }

    .star.favorited {
      color: var(--star-favorite);
      text-shadow: 0 0 4px white, 1px 1px 2px black;
    }

    .carousel-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0, 0, 0, 0.5);
      color: white;
      border: none;
      font-size: 20px;
      padding: 5px;
      cursor: pointer;
      z-index: 5;
    }

    .carousel-nav.left {
      left: 0;
    }

    .carousel-nav.right {
      right: 0;
    }

    @media (max-width: 768px) {
      .card {
        flex: 0 0 45%;
      }
    }

    @media (max-width: 480px) {
      .card {
        flex: 0 0 40%;
      }
    }
  </style>
</head>
<body>
  <header>
    <img src="photo_4994677211969728445_c.jpg" alt="2KO VIP Logo">
    <div class="menu">
      <button onclick="togglePopup()">Filtros</button>
      <button onclick="showFavorites()">Favoritos</button>
    </div>
  </header>
  <div class="popup" id="genrePopup">
    <div class="close-btn" onclick="togglePopup()">X Fechar</div>
    <button onclick="clearFilters()">Remover Filtros</button>
    <hr>
    <button onclick="filterByType('Filme')">Filmes</button>
    <button onclick="filterByType('S√©rie')">S√©ries</button>
    <button onclick="filterByType('Animes / Donghua')">Animes</button>
    <button onclick="filterByType('Anima√ß√£o')">Anima√ß√µes</button>
    <hr>
  </div>
  <h2 style="padding: 10px">üé¨ √öltimos Adicionados</h2>
  <div id="catalog" class="carousel"></div>
  <h2 style="padding: 10px">üìÖ Lan√ßamentos Recentes</h2>
  <div id="byYear" class="carousel"></div>
  <h2 style="padding: 10px">‚≠ê Meus Favoritos</h2>
  <div id="favorites" class="carousel"></div>
  <div id="byGenreContainer"></div>
<script>
  const catalog = document.getElementById("catalog");
  const favoritesCarousel = document.getElementById("favorites");
  const byYearCarousel = document.getElementById("byYear");
  const byGenreContainer = document.getElementById("byGenreContainer");
  const popup = document.getElementById("genrePopup");

  let allItems = [];
  let showingFavorites = false;

  async function fetchCatalog() {
    try {
      const res = await fetch('catalogo.json'); // atualize para o caminho do seu JSON
      const data = await res.json();
      allItems = data.reverse();
      render(allItems);
    } catch (err) {
      catalog.innerHTML = "<p>Erro ao carregar o cat√°logo.</p>";
    }
  }

  function render(items) {
    catalog.innerHTML = '';
    favoritesCarousel.innerHTML = '';
    byYearCarousel.innerHTML = '';
    byGenreContainer.innerHTML = '';

    if (!items.length) {
      catalog.innerHTML = `<div style="padding:20px;">Nenhum resultado encontrado. <a href="https://t.me/c/2699698393/96" target="_blank">üì© Pe√ßa seu filme</a></div>`;
      return;
    }

    const favorites = items.filter(i => localStorage.getItem(i.titulo));
    const byYear = groupByYear(items);
    const byGenre = groupByGenre(items);

    items.forEach(item => catalog.appendChild(createCard(item)));

    favorites.forEach(item => favoritesCarousel.appendChild(createCard(item)));

    Object.entries(byYear).forEach(([year, yearItems]) => {
      byYearCarousel.appendChild(createCarouselRow(`üìÖ Lan√ßamentos ${year}`, yearItems));
    });

    Object.entries(byGenre).forEach(([genre, genreItems]) => {
      if (genreItems.length >= 3) {
        byGenreContainer.appendChild(createCarouselRow(`üé≠ ${genre}`, genreItems));
      }
    });
  }

  function groupByYear(items) {
    const years = {};
    items.forEach(item => {
      const match = item.descricao.match(/20\d{2}/);
      if (match) {
        const year = match[0];
        if (!years[year]) years[year] = [];
        years[year].push(item);
      }
    });
    return years;
  }

  function groupByGenre(items) {
    const genres = {};
    items.forEach(item => {
      item.genero.split(',').forEach(g => {
        const genre = g.trim();
        if (!genres[genre]) genres[genre] = [];
        genres[genre].push(item);
      });
    });
    return genres;
  }

  function createCard(item) {
    const div = document.createElement("div");
    div.className = "card";

    const star = document.createElement("div");
    star.className = "star";
    star.innerHTML = "‚òÖ";
    if (localStorage.getItem(item.titulo)) {
      star.classList.add("favorited");
    }

    star.onclick = (e) => {
      e.stopPropagation();
      if (localStorage.getItem(item.titulo)) {
        localStorage.removeItem(item.titulo);
        star.classList.remove("favorited");
      } else {
        localStorage.setItem(item.titulo, true);
        star.classList.add("favorited");
      }
    };

    div.onclick = () => {
      window.open(item.link, "_blank");
    };

    div.innerHTML = `
      <img src="${item.banner}" alt="${item.titulo}">
      <div class="card-content">
        <div class="title">${item.titulo}</div>
        <div class="meta">${item.descricao}</div>
      </div>
    `;
    div.appendChild(star);
    return div;
  }

  function createCarouselRow(title, items) {
    const section = document.createElement("section");
    section.innerHTML = `<h2 style="padding: 10px">${title}</h2>`;
    const carousel = document.createElement("div");
    carousel.className = "carousel";

    const left = document.createElement("button");
    left.className = "carousel-nav left";
    left.innerHTML = "‚Æú";
    left.onclick = () => carousel.scrollBy({ left: -300, behavior: 'smooth' });

    const right = document.createElement("button");
    right.className = "carousel-nav right";
    right.innerHTML = "‚Æû";
    right.onclick = () => carousel.scrollBy({ left: 300, behavior: 'smooth' });

    items.forEach(i => carousel.appendChild(createCard(i)));

    section.appendChild(left);
    section.appendChild(carousel);
    section.appendChild(right);

    return section;
  }

  function togglePopup() {
    popup.style.display = popup.style.display === 'block' ? 'none' : 'block';
  }

  function clearFilters() {
    render(allItems);
    togglePopup();
  }

  function filterByType(type) {
    const filtered = allItems.filter(i => i.tipo === type);
    render(filtered);
    togglePopup();
  }

  function showFavorites() {
    if (!showingFavorites) {
      const favItems = allItems.filter(i => localStorage.getItem(i.titulo));
      render(favItems);
    } else {
      render(allItems);
    }
    showingFavorites = !showingFavorites;
  }

  window.onload = fetchCatalog;
</script>
</body>
</html>
